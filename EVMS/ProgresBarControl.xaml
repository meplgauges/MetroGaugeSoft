<UserControl x:Class="EVMS.ProgresBarControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="Transparent"
             Width="180"
             Height="170"
             MinWidth="110" MinHeight="195"
             x:Name="root">

    <!-- ===== Resources MUST be here before using them ===== -->
    <UserControl.Resources>
        <LinearGradientBrush x:Key="TrackGradient" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#E8E8E8" Offset="0"/>
            <!-- Light gray top -->
            <GradientStop Color="#D0D0D0" Offset="1"/>
            <!-- Slightly darker bottom -->
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="FillGradientGreen" StartPoint="0,1" EndPoint="0,0">
            <GradientStop Color="#00FF7F" Offset="0"/>
            <GradientStop Color="#00B36B" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="FillGradientRed" StartPoint="0,1" EndPoint="0,0">
            <GradientStop Color="#FF4444" Offset="0"/>
            <GradientStop Color="#B30000" Offset="1"/>
        </LinearGradientBrush>

        <DropShadowEffect x:Key="DropShadow"
                          BlurRadius="25"
                          ShadowDepth="0"
                          Color="#00FFFF"
                          Opacity="0.3"/>

        <DropShadowEffect x:Key="GlowEffect"
                          BlurRadius="15"
                          ShadowDepth="0"
                          Color="#00FFAA"
                          Opacity="0.6"/>

        <DropShadowEffect x:Key="InnerShadow"
                          BlurRadius="10"
                          ShadowDepth="0"
                          Color="#AAA"
                          Opacity="0.4" />

        <TextEffectCollection x:Key="GlowTextEffect">
            <TextEffect PositionStart="0" PositionCount="2147483647">
                <TextEffect.Transform>
                    <TranslateTransform X="0" Y="0"/>
                </TextEffect.Transform>
                <TextEffect.Foreground>
                    <SolidColorBrush Color="#00FFAA"/>
                </TextEffect.Foreground>
            </TextEffect>
        </TextEffectCollection>
    </UserControl.Resources>
    <!-- ===================== DESIGN LAYOUT ===================== -->
    <Viewbox Stretch="Uniform">
        <Border CornerRadius="20"
        BorderThickness="1.2"
        Padding="15"
        Width="130"
        SnapsToDevicePixels="True"
        Effect="{StaticResource DropShadow}">
            <Border.BorderBrush>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#5DD1D8" Offset="0"/>
                    <GradientStop Color="#3FA7D6" Offset="1"/>
                </LinearGradientBrush>
            </Border.BorderBrush>
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#E6FBFF" Offset="0"/>
                    <GradientStop Color="#BAFBFD" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <Grid>
                    <!-- Background track -->
                    <Border Width="15" Height="160" CornerRadius="6"
                            Background="{StaticResource TrackGradient}"
                            BorderThickness="0"
                            Effect="{StaticResource InnerShadow}" />

                    <!-- Below Mean fill -->
                    <Rectangle x:Name="BelowFill"
                               Width="17"
                               Height="0"
                               VerticalAlignment="Bottom"
                               RadiusX="6"
                               RadiusY="6"
                               Fill="{StaticResource FillGradientGreen}" />

                    <!-- Above Mean fill -->
                    <Rectangle x:Name="AboveFill"
                               Width="17"
                               Height="0"
                               VerticalAlignment="Bottom"
                               RadiusX="6"
                               RadiusY="6"
                               Fill="{StaticResource FillGradientGreen}" />

                    <!-- Ticks and labels -->
                    <Canvas Margin="0,0,0,-6"
                            Width="130"
                            Height="150"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Top">
                        <Line X1="0" X2="40" Y1="150" Y2="150"
                              Stroke="Black"
                              StrokeThickness="1"
                              StrokeDashArray="3,2"/>
                        <TextBlock Foreground="Black"
                                   FontSize="15"
                                   Canvas.Right="95"
                                   Canvas.Top="130"
                                   Text="{Binding Min, ElementName=root, StringFormat={}{0:F3}}"/>

                        <Line X1="0" X2="40" Y1="75" Y2="75"
                              Stroke="Black"
                              StrokeThickness="1"
                              StrokeDashArray="3,2"/>
                        <TextBlock Foreground="Black"
                                   FontSize="15"
                                   Canvas.Right="95"
                                   Canvas.Top="74"
                                   Text="{Binding Mean, ElementName=root, StringFormat={}{0:F3}}"/>

                        <Line X1="0" X2="40" Y1="0" Y2="0"
                              Stroke="Black"
                              StrokeThickness="1"
                              StrokeDashArray="3,2"/>
                        <TextBlock Foreground="Black"
                                   FontSize="15"
                                   Canvas.Top="0"
                                   Canvas.Right="95"
                                   Text="{Binding Max, ElementName=root, StringFormat={}{0:F3}}"/>
                    </Canvas>
                </Grid>

                <TextBlock x:Name="BarValue"
                           Text="{Binding Value, ElementName=root, StringFormat={}{0:F3}}"
                           HorizontalAlignment="Center"
                           FontSize="23"
                           FontWeight="Bold"
                           Margin="0,10,0,0"
                           Foreground="Black" />
                <!-- Slightly darker green text -->

                <!-- Title display -->
                <TextBlock x:Name="TitleBox"
                           Height="25"
                           Width="100"
                           Foreground="#333333"
                           Padding="2"
                           FontSize="15"
                           Text="{Binding Title, ElementName=root, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                           HorizontalAlignment="Center"   
                           FontWeight="Bold"                 
                           TextAlignment="Center"/>
                <!-- ✅ Text itself centered -->

            </StackPanel>
        </Border>
    </Viewbox>
</UserControl>
